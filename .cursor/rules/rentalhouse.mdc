---
description: 
globs: 
alwaysApply: true
---
# Rental House API Documentation

## Overview
This API provides comprehensive CRUD operations for rental house management, including advanced filtering, searching, and pagination capabilities.

## Base URL
```
/api/rental-houses
```

## Response Format
All API responses follow this standard format:
```json
{
  "success": boolean,
  "message": string,
  "data": object | array | null,
  "pagination": object (only for paginated endpoints)
}
```

---

## Endpoints

### 1. Get All Rental Houses
**GET** `/api/rental-houses`

Retrieve all rental houses with optional filtering and pagination.

#### Query Parameters
| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `page` | number | Page number (default: 1) | `?page=2` |
| `limit` | number | Items per page (default: 10) | `?limit=20` |
| `sortBy` | string | Sort field: `weeklyPrice`, `createdAt`, `viewCount` | `?sortBy=weeklyPrice` |
| `sortOrder` | string | Sort order: `asc`, `desc` (default: desc) | `?sortOrder=asc` |
| `suburb` | string | Filter by suburb | `?suburb=South Brisbane` |
| `minPrice` | number | Minimum weekly price | `?minPrice=400` |
| `maxPrice` | number | Maximum weekly price | `?maxPrice=800` |
| `bedrooms` | number | Number of bedrooms | `?bedrooms=2` |
| `bathrooms` | number | Number of bathrooms | `?bathrooms=2` |
| `propertyType` | string | Property type | `?propertyType=apartment` |
| `furnished` | boolean | Furnished status | `?furnished=true` |
| `petsAllowed` | boolean | Pets allowed | `?petsAllowed=true` |
| `smokingAllowed` | boolean | Smoking allowed | `?smokingAllowed=false` |
| `status` | string | Property status | `?status=available` |

#### Example Request
```bash
GET /api/rental-houses?page=1&limit=5&suburb=Brisbane&minPrice=500&maxPrice=1000&bedrooms=2&sortBy=weeklyPrice&sortOrder=asc
```

#### Example Response
```json
{
  "success": true,
  "message": "Rental houses retrieved successfully",
  "data": [
    {
      "id": 1,
      "title": "Modern 2BR Apartment with City Views",
      "description": "Stunning 2-bedroom apartment...",
      "weeklyPrice": "650.00",
      "depositPrice": "2600.00",
      "bondAmount": "1300.00",
      "bedrooms": 2,
      "bathrooms": 2,
      "carSpaces": 1,
      "studyRooms": 0,
      "propertyType": "apartment",
      "streetAddress": "123 Grey Street",
      "suburb": "South Brisbane",
      "state": "QLD",
      "postcode": "4101",
      "country": "Australia",
      "latitude": "-27.4810",
      "longitude": "153.0234",
      "images": ["https://example.com/images/house1_1.jpg"],
      "mainImageIndex": 0,
      "features": ["pool", "gym", "balcony", "air_conditioning"],
      "furnished": true,
      "petsAllowed": false,
      "smokingAllowed": false,
      "availableFrom": "2024-02-01T00:00:00.000Z",
      "minimumLeaseTerm": 12,
      "maximumLeaseTerm": 24,
      "floorArea": 85,
      "landArea": null,
      "buildYear": 2018,
      "utilitiesIncluded": ["water", "internet"],
      "additionalCosts": [{"name": "Parking", "amount": 50, "frequency": "weekly"}],
      "contactName": "Sarah Johnson",
      "contactPhone": "0412345678",
      "contactEmail": "sarah@realestate.com.au",
      "agencyName": "Brisbane Premium Properties",
      "status": "available",
      "isActive": true,
      "viewCount": 45,
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z",
      "publishedAt": "2024-01-15T10:00:00.000Z",
      "propertyConfig": "2b2b1c"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 5,
    "total": 15,
    "totalPages": 3,
    "hasNext": true,
    "hasPrev": false
  }
}
```

---

### 2. Get Rental House by ID
**GET** `/api/rental-houses/:id`

Retrieve a specific rental house by its ID. This endpoint also increments the view count.

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | number | Rental house ID |

#### Example Request
```bash
GET /api/rental-houses/1
```

#### Example Response
```json
{
  "success": true,
  "message": "Rental house retrieved successfully",
  "data": {
    "id": 1,
    "title": "Modern 2BR Apartment with City Views",
    // ... full rental house object
    "propertyConfig": "2b2b1c"
  }
}
```

#### Error Response (404)
```json
{
  "success": false,
  "message": "Rental house not found",
  "data": null
}
```

---

### 3. Create Rental House
**POST** `/api/rental-houses`
Create a new rental house listing.

#### Request Body
```json
{
  "title": "Beautiful 3BR House in Paddington",
  "description": "Charming family home with modern amenities...",
  "weeklyPrice": "850.00",
  "depositPrice": "3400.00",
  "bondAmount": "1700.00",
  "bedrooms": 3,
  "bathrooms": 2,
  "carSpaces": 2,
  "studyRooms": 1,
  "propertyType": "house",
  "streetAddress": "45 Latrobe Terrace",
  "suburb": "Paddington",
  "state": "QLD",
  "postcode": "4064",
  "country": "Australia",
  "latitude": "-27.4598",
  "longitude": "152.9987",
  "images": ["https://example.com/images/house_1.jpg"],
  "mainImageIndex": 0,
  "features": ["garden", "heritage_features", "polished_floors"],
  "furnished": false,
  "petsAllowed": true,
  "smokingAllowed": false,
  "availableFrom": "2024-03-01T00:00:00.000Z",
  "minimumLeaseTerm": 12,
  "maximumLeaseTerm": null,
  "floorArea": 120,
  "landArea": 405,
  "buildYear": 1920,
  "utilitiesIncluded": ["water"],
  "additionalCosts": [],
  "contactName": "Michael Chen",
  "contactPhone": "0423456789",
  "contactEmail": "michael@paddingtonrealty.com.au",
  "agencyName": "Paddington Realty"
}
```

#### Example Response (201)
```json
{
  "success": true,
  "message": "Rental house created successfully",
  "data": {
    "id": 6,
    // ... full rental house object with generated fields
    "propertyConfig": "3b2b2c1s"
  }
}
```

#### Error Response (400)
```json
{
  "success": false,
  "message": "Title is required",
  "data": null
}
```

---

### 4. Update Rental House
**PUT** `/api/rental-houses/:id`

Update an existing rental house listing.

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | number | Rental house ID |

#### Request Body (Partial Update)
```json
{
  "weeklyPrice": "900.00",
  "description": "Updated description with new features...",
  "features": ["garden", "heritage_features", "polished_floors", "renovated_kitchen"]
}
```

#### Example Response (200)
```json
{
  "success": true,
  "message": "Rental house updated successfully",
  "data": {
    "id": 1,
    // ... updated rental house object
    "propertyConfig": "3b2b2c1s"
  }
}
```

---

### 5. Delete Rental House
**DELETE** `/api/rental-houses/:id`

Soft delete a rental house (sets `isActive` to false and `status` to 'withdrawn').

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | number | Rental house ID |

#### Example Response (200)
```json
{
  "success": true,
  "message": "Rental house deleted successfully",
  "data": null
}
```

---

### 6. Get Rental Houses by Suburb
**GET** `/api/rental-houses/suburb/:suburb`

Retrieve all rental houses in a specific suburb.

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `suburb` | string | Suburb name |

#### Example Request
```bash
GET /api/rental-houses/suburb/South Brisbane
```

#### Example Response
```json
{
  "success": true,
  "message": "Rental houses in South Brisbane retrieved successfully",
  "data": [
    // ... array of rental houses in the suburb
  ]
}
```

---

### 7. Get Rental Houses by Price Range
**GET** `/api/rental-houses/price-range/:minPrice/:maxPrice`

Retrieve rental houses within a specific price range.

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `minPrice` | number | Minimum weekly price |
| `maxPrice` | number | Maximum weekly price |

#### Example Request
```bash
GET /api/rental-houses/price-range/400/800
```

#### Example Response
```json
{
  "success": true,
  "message": "Rental houses in price range $400-$800 retrieved successfully",
  "data": [
    // ... array of rental houses within price range
  ]
}
```

---

### 8. Search Rental Houses
**GET** `/api/rental-houses/search/:keyword`

Search rental houses by keyword in the title.

#### Path Parameters
| Parameter | Type | Description |
|-----------|------|-------------|
| `keyword` | string | Search keyword |

#### Example Request
```bash
GET /api/rental-houses/search/apartment
```

#### Example Response
```json
{
  "success": true,
  "message": "Search results for \"apartment\" retrieved successfully",
  "data": [
    // ... array of matching rental houses
  ]
}
```

---

## Property Configuration Format

The API automatically generates a `propertyConfig` field for each rental house using the format:
- `{bedrooms}b{bathrooms}b{carSpaces}c{studyRooms}s`
- Example: `2b2b1c` (2 bedrooms, 2 bathrooms, 1 car space, 0 study rooms)
- Example: `3b2b2c1s` (3 bedrooms, 2 bathrooms, 2 car spaces, 1 study room)

## Error Handling

### Common Error Codes
- **400 Bad Request**: Invalid input data or missing required fields
- **404 Not Found**: Rental house not found
- **500 Internal Server Error**: Server-side error

### Error Response Format
```json
{
  "success": false,
  "message": "Error description",
  "data": null
}
```

## Data Validation

### Required Fields for Creation
- `title`: Non-empty string
- `weeklyPrice`: Positive decimal
- `depositPrice`: Positive decimal
- `bedrooms`: Non-negative integer
- `bathrooms`: Non-negative integer
- `propertyType`: Non-empty string
- `streetAddress`: Non-empty string
- `suburb`: Non-empty string
- `state`: Non-empty string
- `postcode`: Non-empty string
- `availableFrom`: Valid date

### Optional Fields
All other fields are optional and have sensible defaults.

## Usage Examples

### Complex Filtering Query
```bash
GET /api/rental-houses?suburb=Brisbane&minPrice=500&maxPrice=1200&bedrooms=2&bathrooms=2&furnished=true&petsAllowed=false&sortBy=weeklyPrice&sortOrder=asc&page=1&limit=10
```

### Creating a New Listing
```bash
curl -X POST /api/rental-houses \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Cozy Studio Apartment",
    "weeklyPrice": "450.00",
    "depositPrice": "1800.00",
    "bedrooms": 1,
    "bathrooms": 1,
    "propertyType": "apartment",
    "streetAddress": "789 Queen Street",
    "suburb": "Brisbane City",
    "state": "QLD",
    "postcode": "4000",
    "availableFrom": "2024-04-01T00:00:00.000Z"
  }'
```

### Updating a Listing
```bash
curl -X PUT /api/rental-houses/1 \
  -H "Content-Type: application/json" \
  -d '{
    "weeklyPrice": "700.00",
    "description": "Price updated - now includes utilities!"
  }'
``` 
